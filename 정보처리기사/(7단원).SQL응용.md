# **Chapter07.SQL응용**

- **트랜잭션 : DB시스템에서 하나의 논리적 기능을 정상적으로 수행하기 위한 작업의 기본 단위**
- **트랜잭션의 특성(ACID)**
  - **원자성(Atomicity): 트랜잭션을 구성하는 연산 전체가 모두 정상적으로 실행되거나 모두 취소되어야 하는 성질**
  - **일관성(Consistency): 시스템이 가지고 있는 고정요소는 트랜잭션 수행전과 트랜잭션 수행 완료 후의 상태가 같아야 하는 성질**
  - **격리성(isolation): 동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않아야 한다는 성질**
  - **영속성(Durability): 성공이 완료된 트랜잭션의 결과는 영속적으로 데이터베이스에 저장되어야하는 성질**

---

### **TCL(Transaction Control Language)**

- **Commit : 트랜잭션을 메모리에 영구적으로 저장하는 명령어**
- **ROLLBACK: 트랜잭션 내역을 저장 무효화시키는 명령어**
- **CHECKPOINT: ROLLBACK을 위한 시점을 지정하는 명령어**

---

### **병행 제어 미보장시 문제점[갱현모연]**

- **갱신 손실(Lost Update): 먼저 실행된 트랜잭션의 결과를 나중에 실행된 트랜잭션이 덮어쓸 때 발생하는 오류**
- **현황 파악오류(Dirty Redad): 트랜잭션의 중간 수행 결과를 다른 트랜잭션이 참조하여 발생하는 오류**
- **모순성(Inconsistency): 두 트랜잭션이 동시에 실행되어 데이터베이스의 일관성이 결여되는 오류**
- **연쇄복귀(Cascading Rollback): 복수의 트랜잭션이 데이터 공유시 특정 트랜잭션 처리를 취소할 경우 트랜잭션이 처리한 곳의 부분을 취소하지 못하는 오류**

---

### **병행 제어 기법의 종류[로 낙타다]**

- **로킹 : 하나의 트랜잭션을 실행하는 동안 특정 데이터 항목에 대해서 다른 트랜잭션이 동시에 접근하지 못하도록 상호배제 기능을 제공하는 기법**
  - **로킹 단위가 작아지면, 데이터베이스 공유도가 증가**
  - **로킹 단위가 작아지면, 로킹 오버헤드가 증가**
- **낙관적 검증(Optimistic Validation) : 트랜잭션이 어떠한 검증도 수행하지 않고 일단 트랜잭션을 수행하고, 트랜잭션 종료 시 검증을 수행하여 데이터베이스에 반영하는 기법**
- **타임스탬프 순서(Time Stamp Ordering): 트랜잭션과 트랜잭션이 읽거나 갱신한 데이터에 대해 트랜잭션이 실행을 시작하기 전에 타임 스탬프를 부여하여 부여된 시간에 따라 트랜잭션 작업을 수행하는 기법**
- **다중버전 동시성 제어(MVCC: Multi Version Concurrency Control): 트랜잭션의 타임스탬프와 접근하려는 데이터의 타임스탬프를 비교하여 직렬가능성이 보장되는 적절한 버전을 선택하여 접근하도록 하는 기법**

---

### **회복 기법 요소**

- **REDO: 데이터베이스가 비정상적으로 종료되었을 때 디스크에 저장된 로그를 분석하여 트랜잭션의 시작(Start)과 완료(Commit)에 대한 기록이 있는 트랜잭션들의 작업을 재작업하는 기법**
- **UNDO: 데이터베이스가 비정상적으로 종료되었을 때 디스크에 저장된 로그를 분석하여 트랜잭션의 시작은 있지만, 완료 기록이 없는 트랜잭션들이 작업한 변경 내용들을 모두 취소하는 기법**

---

### **회복 기법 종류[회로체그]**

- **로그 기반 회복 기법**
  - **지연 갱신 회복 기법: 트랜잭션이 완료되기 전까지 데이터베이스에 기록하기 않는 기법**
  - **즉각 갱신 회복 기법: 트랜잭션 수행 중 갱신 결과를 바로 DB에 반영하는 기법**
- **체크 포인트 회복 기법 : 장애 발생 시 검사점 이후에 처리된 트랜잭션에 대해서만 장애 발생 이전 상태로 복원시키는 회복 기법**
- **그림자 페이징 기법: 데이터베이스 트랜잭션 수행 시 복제본을 생성하여 데이터베이스 장애 시 이를 이용해 복구하는 기법**

---

### **스키마**

- **외부스키마: 사용자나 개발자의 관점에서 필요로 하는 데이터베이스의 논리적 구조, 사용자 뷰, 서브 스키마**
- **개념스키마: DB의 전체적인 논리적 구조, 전체적인 뷰**
- **내부스키마: 물리적 저장 장치의 관점에서 보는 DB 구조**

---

### **DDL(CREATE, ALTER, DROP, TRUNCATE)**

```sql
CREATE TABLE 테이블명
{
	컬럼명 데이터 타입[제약조건],
	...
};
제약조건: PRIMARY KEY, FOREIGN KEY, UNIQUE, NOT NULL, CHECK(조건식), DEFAULT
```

- **컬럼 추가**

```sql
ALTER TABLE 테이블명 ADD 컬럼명 데이터타입[제약조건];
```

- **컬럼 수정**

```sql
ALTER TABLE 테이블명 MODIFY 컬럼명 데이터타입[제약조건];
```

- **컬럼 삭제**

```sql
ALTER TABLE 테이블명 DROP COLUMN 컬럼명;
```

- **테이블 삭제**

```sql
DROP TABLE 테이블명 [CASCADE | RESTRICT];

CASCADE: 참조하는 테이블까지 연쇄적으로 제거하는 옵션
RESTRICT: 다른 테이블이 삭제할 테이블을 참조 중이면 제거하지 않는 옵션
```

- **테이블 내의 데이터들을 삭제**

```sql
TRUNCATE TABLE 테이블명;
```

---

### **VIEW 관련 DDL**

- **CREATE VIEW**

```sql
CREATE VIEW 뷰이름 AS
조회쿼리;
```

- **CREATE OR REPLACE VIEW**

```sql
CREATE OR REPLACE VIEW 뷰이름 AS
조회쿼리;
```

- **DROP VIEW**

```sql
DROP VIEW 뷰이름;
```

---

### **INDEX 관련 DDL**

- **CREATE INDEX(인덱스 생성)**

```sql
CREATE [UNIQUE] INDEX 인덱스명 ON 테이블명(컬럼명1, 컬럼명2...);
```

- **ALTER INDEX(인덱스를 수정)**

```sql
ALTER [UNIQUE] IDNEX 인덱스명 ON 테이블명(컬럼명1, 컬럼명2, ...);
```

- **DROP INDEX(인덱스를 삭제)**

```sql
DROP INDEX 인덱스명;
```

---

### **DML(SELECT, INSERT, UPDATE, DELETE)**

- **SELECT 명령어[셀프 웨 구해오]**

```sql
SELCT [ALL | DISTINCT] 속성명1, 속성명2...
	FROM 테이블명1, ....
[WHERE 조건]
[GROUP BY 속성명1, ..]
[HAVING 그룹조건]
[ORDER BY 속성 [ASC | DESC]];

ALL: 모든 츄플을 검색할 때 사용, 명시하지 않은 경우 ALL로 인식
DISTINCT: 중복된 속성이 조회될 겨웅 그 중 한개만 검색

```

---

### **WHERE절[비교, 범위, 집합, 패턴, NULL, 복합조건]**

- **집합: IN, NOT IN**

  - **컬럼 IN(값1, 값2,…)**
    - **컬럼이 패턴에 포함된 경우의 데이터 조회**
  - **컬럼 NOT IN(값1, 값2…)**
    - **컬럼이 IN 안에 포함되어 있지 않은 경우의 데이터 조회**

- **패턴: LIKE, 컬럼 LIKE 패턴**

  - **%: 0개 이상의 문자열과 일치**
  - **[ ]: 1개의 문자와 일치**
  - **[ ^ ] : 1개의 문자와 불일치**
  - **\_ : 특정 위치의 1개의 문자와 일치**

- **NULL: IS NULL, IS NOT NULL**
  - **컬럼 IS NULL : 컬럼이 NULL인 데이터 조회**
  - **컬럼 IS NOT NULL: 컬럼이 NULL이 아닌 데이터 조회**

---

### **INSERT(데이터 삽입) 명령어**

```sql
INSERT INTO 테이블명(속성명1,...)
VALUES (데이터1,...);
```

---

### **UPDATE(데이터 변경) 명령어**

```sql
UPDATE 테이블명
	SET 속성명 = 데이터,...
WHERE 조건;
```

---

### **DELETE(데이터 삭제) 명령어**

```sql
DELETE FROM 테이블명
WHERE 조건;
```

---

### **DCL**

- **GRANT(권한 부여) 명령어**

```sql
GRANT 권한 ON 테이블 TO 사용자;
```

- **REVOKE(권한 회수) 명령어**

```sql
REVOKE 권한 ON 테이블 FROM 사용자;
```

---

### **다중 행 연산자**

- **다중 행 연산자는 서브 쿼리의 결과가 여러 개의 튜플을 반환하는 다중 행 서브쿼리에서 사용되는 연산자이다.**
- **다중 행 연산자로 IN, ANY, SOME, ALL, EXISTS를 사용한다.**
- **IN: 리턴되는 값 중에서 조건에 해당하는 값이 있으면 참**
- **ANY : 서브쿼리에 의해 리턴되는 각각의 값과 조건을 비교하여 하나 이상을 만족하면 참**
- **ALL: 값을 서브쿼리에 의해 리턴되는 모든 값과 조건 값을 비교하여 모든 값을 만족해야만 참**
- **EXISTS: 메인 쿼리의 비교 조건이 서브쿼리의 결과 중에서 만족하는 값이 하나라도 존재하면 참**

---

### **절차형 SQL**

- **프로시저(Procedure) : 일련의 쿼리들을 마치 하나의 함수처럼 실행하기 위한 쿼리의 집합**
- **사용자 정의 함수(User-Defined Function): 일련의 SQL 처리를 수행하고, 수행 결과를 단일 값으로 반환할 수 있는 절차형 SQL**
- **트리거: 데이터베이스 시스템에서 삽입, 갱신, 삭제 등의 이벤트가 발생할 때마다 관련 작업이 자동으로 수행되는 절차형 SQL**
